<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"celeo.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="I&#39;ve made a good bit of progress, including figuring out things I noted in the last post.">
<meta property="og:type" content="article">
<meta property="og:title" content="IRC, part 3">
<meta property="og:url" content="https://celeo.github.io/2021/07/02/IRC-part-3/index.html">
<meta property="og:site_name" content="Etchings">
<meta property="og:description" content="I&#39;ve made a good bit of progress, including figuring out things I noted in the last post.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-07-03T02:05:43.000Z">
<meta property="article:modified_time" content="2024-04-30T02:23:45.334Z">
<meta property="article:author" content="Matt Boulanger">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="irc">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://celeo.github.io/2021/07/02/IRC-part-3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://celeo.github.io/2021/07/02/IRC-part-3/","path":"2021/07/02/IRC-part-3/","title":"IRC, part 3"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>IRC, part 3 | Etchings</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Etchings</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-github"><a href="https://github.com/Celeo" rel="section" target="_blank"><i class="fa fa-link fa-fw"></i>GitHub</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RFC-differences"><span class="nav-number">1.</span> <span class="nav-text">RFC differences</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-improvements"><span class="nav-number">2.</span> <span class="nav-text">Code improvements</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Matt Boulanger</p>
  <div class="site-description" itemprop="description">Personal blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://celeo.github.io/2021/07/02/IRC-part-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Matt Boulanger">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Etchings">
      <meta itemprop="description" content="Personal blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="IRC, part 3 | Etchings">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          IRC, part 3
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-02 19:05:43" itemprop="dateCreated datePublished" datetime="2021-07-02T19:05:43-07:00">2021-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-29 19:23:45" itemprop="dateModified" datetime="2024-04-29T19:23:45-07:00">2024-04-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>I&#39;ve made a good bit of progress, including figuring out things I noted in the last post.</p>
<span id="more"></span>

<h2 id="RFC-differences"><a href="#RFC-differences" class="headerlink" title="RFC differences"></a>RFC differences</h2><p>Now that I&#39;m looking at the IRC RFC that modern clients &amp; servers are using, things are making more sense and what I&#39;m recording on the IRC client I&#39;m using to connect to Libera.Chat is matching up with RFC 2812.</p>
<p>I still don&#39;t get how sending the user&#39;s nick back to them is documented in the semi-BNF for messages in the RFC document, but at least it seems consistent enough for me to model my implementation after. One of the goals of this project was to see how far I could get <em>just</em> with the RFC, so this is an interesting experience, and I&#39;m not discouraged by having to look at logs for existing client&#x2F;server interaction.</p>
<h2 id="Code-improvements"><a href="#Code-improvements" class="headerlink" title="Code improvements"></a>Code improvements</h2><p>In the last article, I noted how I was confused about having to use <code>Task</code>s to wrap intra-<code>GenServer</code> communications. I didn&#39;t understand why I could make <em>some</em> cross-process calls without a <code>Task</code> but others would give an error along the lines of &quot;process cannot call itself&quot;. The issue was pretty simple, and I&#39;ll break down the code flow for you here so you don&#39;t have to go searching through the code.</p>
<ol>
<li>The user (the person using a client) connects to the TCP server</li>
<li>They type a message and send it through their client (an actual IRC client or telnet client, doesn&#39;t matter)</li>
<li>The IRC server I&#39;m writing gets that in the process for <em>that</em> user&#39;s TCP socket, which I call <a target="_blank" rel="noopener" href="https://github.com/Celeo/simple_irc_server/blob/fb7d7c1f5bc7be6ff5b9ca303a061462b4398330/lib/client_connection.ex">IRC.ClientConnection</a>, at <a target="_blank" rel="noopener" href="https://github.com/Celeo/simple_irc_server/blob/fb7d7c1f5bc7be6ff5b9ca303a061462b4398330/lib/client_connection.ex#L28">handle_info with a <code>&#123;:tcp, socket, message&#125;</code> shape</a></li>
<li>That function does the parsing of the message and puts it in a tuple that&#39;s easier to work with down the line</li>
<li>The client process then <a target="_blank" rel="noopener" href="https://github.com/Celeo/simple_irc_server/blob/fb7d7c1f5bc7be6ff5b9ca303a061462b4398330/lib/client_connection.ex#L43">sends it</a> to the single server process</li>
<li>The server <a target="_blank" rel="noopener" href="https://github.com/Celeo/simple_irc_server/blob/fb7d7c1f5bc7be6ff5b9ca303a061462b4398330/lib/server.ex#L33">gets the command</a>, <a target="_blank" rel="noopener" href="https://github.com/Celeo/simple_irc_server/blob/fb7d7c1f5bc7be6ff5b9ca303a061462b4398330/lib/server.ex#L37-L42">builds the module name for the command, and calls it</a>, passing in the command information along with the calling client&#39;s state and the server&#39;s state</li>
<li>The individual module&#39;s function handles other processing and process communication</li>
</ol>
<p>With this setup, I needed to wrap any process calls in the command modules with <code>Task.start(...)</code>, otherwise I&#39;d get the aforementioned error. It&#39;s important to note that steps 3, 5, and 7 use <strong>cross-process communication</strong>, while step 6 uses a <strong>direct function call</strong>. Since most of these steps are already using cross-process communication, I didn&#39;t need to do anything to enable that. Since step 6 is using a direct function call, it&#39;s not taking advantage of <em>any</em> of the cross-process communication features of the language and runtime.</p>
<p>To fix this, I simply wrapped that single call from the server to the command module with a <code>Task.start(...)</code> so that it would align with the rest of the code flow, and that worked. I was able to remove all <code>Task</code> process usage in the command modules and am able to use cross-process communication with any other process. Instead of running the command from the server process and wrapping messages <em>back</em> to the server with a <code>Task</code>, I wrap the command processing in a <code>Task</code> so that it <em>is</em> a process and can communicate with other processes like the rest of the application.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/programming/" rel="tag"># programming</a>
              <a href="/tags/irc/" rel="tag"># irc</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/01/IRC-part-2/" rel="prev" title="IRC, part 2">
                  <i class="fa fa-chevron-left"></i> IRC, part 2
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/14/Initial-thoughts-on-SOLO/" rel="next" title="Initial thoughts on SOLO">
                  Initial thoughts on SOLO <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Matt Boulanger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
